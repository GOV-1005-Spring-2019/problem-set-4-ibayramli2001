---
title: "ps_4"
author: "Ilkin Bayramli"
date: "February 24, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libs, echo=FALSE, message=FALSE, error=FALSE}
library(tidyverse)
library(dplyr)
library(stringr)
library(ggplot2)
library(lubridate)
library(devtools)
library(gt)
```

```{r code, echo=FALSE, message=FALSE, error=FALSE}
elections <- read_csv("ps_4_elections-poll-nc09-3.csv")

dem_support_count <- filter(elections, response == "Dem") %>% 
  count()

diff_rep_und <- filter(elections,
                       response %in% c("Rep", "Und")) %>%
  group_by(response) %>%
  summarize(n = n()) %>% 
  summarize(diff = n[1] - n[2])

gender_diff <- filter(elections, 
                      gender != gender_combined) %>% 
  nrow()

white_ambig <- filter(elections, 
                      race_eth == "White" & file_race_black != race_eth) %>%
  nrow()

time_diff <- elections %>% 
  filter(response %in% c("Dem", "Rep")) %>%
  select(response, timestamp) %>% 
  group_by(response) %>%
  summarize(first = minute(min(timestamp))) %>%
  summarize(diff = first[2] - first[1])
```
```{r}

elections %>% 
  
  # I think it would be reasonable to not consider [DO NOT READ] ones since the respondents don't want to be considered in racial discussions
  # and put percentages in terms of the remaining data
  filter(race_eth != "[DO NOT READ] Don't know/Refused") %>% 
  select(race_eth, response, final_weight) %>%
  group_by(race_eth, response)  %>%
  summarize(total_weight = sum(final_weight)) %>%
  spread(response, total_weight) %>% 
  mutate(Und = replace(Und, is.na(Und), 0),
         `3` = replace(`3`, is.na(`3`), 0),
         Total = Dem + Rep + Und +`3`,
         Dem = Dem/Total, 
         Rep = Rep/Total, 
         Und = Und/Total,
         Total = Total*100)  %>%
  ungroup() %>%
  mutate( race_eth = factor(race_eth, 
                 levels = c("White",
                            "Black", 
                            "Hispanic", 
                            "Asian", 
                            "Other"))) %>%
  select(-`3`, -Total) %>%
  arrange(factor(race_eth)) %>%  
  gt() %>% 
  tab_header(
    title = "Polling Results from North Carolina’s 9th Congressional District") %>% 
  
  cols_label(
    race_eth = "Race/Ethnicity",
    Dem = "Democrats",
    Rep = "Republicans",
    Und = "Undecided"
  ) %>%
  
  fmt_percent(columns = vars(Dem, Rep, Und), 
              decimals = 0) 
```


There were `r dem_support_count` respondents who supported the Democratic candidate.

There were `r diff_rep_und` more respondents who favored the Republican candidate than who were Undecided.

There are two gender variables (gender and gender_combined). There are `r gender_diff` individuals for whom these
variables have different values.

There are `r white_ambig` respondents listed as “White” under race_eth who are not listed as “White” under file_race_black.

The first response of Rep came `r time_diff` minutes (rounded to the nearest minute) before the first response of Dem.